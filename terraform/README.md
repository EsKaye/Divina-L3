# GameDin L3 + AthenaMist AI Infrastructure

This directory contains the Terraform infrastructure code for the GameDin L3 gaming blockchain ecosystem with integrated AthenaMist AI services.

## üèóÔ∏è Architecture Overview

The infrastructure is designed as a production-ready, scalable gaming platform with the following components:

### Core Infrastructure
- **VPC** with public and private subnets across multiple AZs
- **EKS Cluster** with specialized node groups for gaming and AI workloads
- **RDS PostgreSQL** for persistent data storage
- **ElastiCache Redis** for caching and session management
- **Amazon MQ** for message queuing
- **Application Load Balancer** with WAF protection
- **S3 Buckets** for static assets, logs, backups, and AI models
- **Route53** for DNS management and SSL certificates
- **CloudWatch** for comprehensive monitoring and alerting

### AI Services
- **NovaSanctum AI** for fraud detection and player analytics
- **AthenaMist AI** for strategic analysis and game intelligence
- **Unified AI Service** for orchestration and consensus

### Gaming Services
- **Real-time Gaming Engine** with WebSocket support
- **Blockchain Integration** for smart contract interactions
- **NFT Marketplace** for digital asset trading
- **Cross-chain Bridge** for asset transfers

## üìÅ Directory Structure

```
terraform/
‚îú‚îÄ‚îÄ main.tf                 # Main Terraform configuration
‚îú‚îÄ‚îÄ variables.tf            # Variable definitions
‚îú‚îÄ‚îÄ outputs.tf              # Output definitions
‚îú‚îÄ‚îÄ terraform.tfvars        # Variable values (generated)
‚îú‚îÄ‚îÄ deploy.ps1              # PowerShell deployment script
‚îú‚îÄ‚îÄ deploy.sh               # Bash deployment script
‚îú‚îÄ‚îÄ modules/                # Reusable Terraform modules
‚îÇ   ‚îú‚îÄ‚îÄ vpc/               # VPC and networking
‚îÇ   ‚îú‚îÄ‚îÄ eks/               # EKS cluster and node groups
‚îÇ   ‚îú‚îÄ‚îÄ rds/               # RDS PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ redis/             # ElastiCache Redis
‚îÇ   ‚îú‚îÄ‚îÄ mq/                # Amazon MQ
‚îÇ   ‚îú‚îÄ‚îÄ alb/               # Application Load Balancer
‚îÇ   ‚îú‚îÄ‚îÄ s3/                # S3 buckets
‚îÇ   ‚îú‚îÄ‚îÄ route53/           # Route53 and SSL certificates
‚îÇ   ‚îú‚îÄ‚îÄ cloudwatch/        # CloudWatch monitoring
‚îÇ   ‚îî‚îÄ‚îÄ ecs/               # ECS services
‚îî‚îÄ‚îÄ README.md              # This file
```

## üöÄ Quick Start

### Prerequisites

1. **AWS CLI** configured with appropriate credentials
2. **Terraform** v1.0+ installed
3. **Docker** for container management
4. **kubectl** for Kubernetes management
5. **PowerShell** (for Windows) or **Bash** (for Linux/macOS)

### Deployment Steps

#### Option 1: PowerShell (Windows)

```powershell
# Navigate to terraform directory
cd terraform

# Run deployment script
.\deploy.ps1 -Environment dev -Region us-east-1 -ProjectName gamedin-l3 -DomainName gamedin-l3.com

# For production deployment
.\deploy.ps1 -Environment prod -Region us-east-1 -ProjectName gamedin-l3 -DomainName gamedin-l3.com -SkipConfirmation
```

#### Option 2: Bash (Linux/macOS)

```bash
# Navigate to terraform directory
cd terraform

# Make script executable
chmod +x deploy.sh

# Run deployment script
./deploy.sh dev us-east-1 gamedin-l3 gamedin-l3.com

# For production deployment
./deploy.sh prod us-east-1 gamedin-l3 gamedin-l3.com --skip-confirmation
```

#### Option 3: Manual Terraform Commands

```bash
# Initialize Terraform
terraform init

# Create terraform.tfvars (or use the script)
# Edit terraform.tfvars with your configuration

# Plan the deployment
terraform plan

# Apply the deployment
terraform apply
```

## ‚öôÔ∏è Configuration

### Environment Variables

The deployment scripts support the following parameters:

- `Environment`: Deployment environment (dev, staging, prod)
- `Region`: AWS region for deployment
- `ProjectName`: Name of the project (used for resource naming)
- `DomainName`: Primary domain name for the application
- `Destroy`: Flag to destroy resources instead of creating them
- `PlanOnly`: Flag to only create a plan without applying
- `SkipConfirmation`: Flag to skip confirmation prompts

### Customization

You can customize the infrastructure by modifying the following files:

1. **terraform.tfvars**: Main configuration file (generated by scripts)
2. **variables.tf**: Variable definitions and defaults
3. **modules/*/variables.tf**: Module-specific configurations

### Key Configuration Options

#### EKS Configuration
```hcl
eks_cluster_version = "1.28"
eks_node_groups = {
  general = {
    instance_types = ["t3.medium"]
    min_size       = 1
    max_size       = 3
    desired_size   = 2
  }
  gaming = {
    instance_types = ["c5.large"]
    min_size       = 1
    max_size       = 5
    desired_size   = 2
  }
  ai = {
    instance_types = ["g4dn.xlarge"]
    min_size       = 1
    max_size       = 3
    desired_size   = 1
  }
}
```

#### RDS Configuration
```hcl
rds_instance_class = "db.t3.micro"
rds_allocated_storage = 20
rds_storage_type = "gp2"
rds_backup_retention_period = 7
```

#### Monitoring Configuration
```hcl
alert_emails = ["admin@yourdomain.com"]
alert_phone_numbers = ["+1234567890"]
```

## üîß Module Details

### VPC Module
- Creates VPC with public and private subnets
- Configures NAT gateways for private subnet internet access
- Sets up route tables and security groups
- Enables VPC flow logs for monitoring

### EKS Module
- Deploys EKS cluster with multiple node groups
- Configures IAM roles and policies
- Sets up cluster autoscaling
- Enables cluster monitoring

### RDS Module
- Deploys PostgreSQL RDS instance
- Configures backup and maintenance windows
- Sets up parameter groups and monitoring
- Enables encryption and security

### Redis Module
- Deploys ElastiCache Redis cluster
- Configures parameter groups and user groups
- Sets up monitoring and alerts
- Enables encryption and security

### ALB Module
- Deploys Application Load Balancer
- Configures target groups and listeners
- Sets up WAF protection
- Enables access logging

### S3 Module
- Creates multiple S3 buckets for different purposes
- Configures lifecycle policies and encryption
- Sets up CORS and bucket policies
- Enables versioning and access logging

### Route53 Module
- Manages DNS records and hosted zones
- Configures SSL certificates
- Sets up health checks and failover
- Enables geolocation and latency routing

### CloudWatch Module
- Creates comprehensive monitoring dashboard
- Sets up SNS topics for alerts
- Configures metric alarms
- Creates log groups for application logs

### ECS Module
- Deploys ECS services for application and API
- Configures task definitions and roles
- Sets up auto scaling policies
- Manages load balancer integration

## üìä Monitoring and Observability

### CloudWatch Dashboard
The infrastructure includes a comprehensive CloudWatch dashboard with:

- **Load Balancer Metrics**: Request count, response time, error rates
- **ECS Service Metrics**: CPU and memory utilization
- **RDS Metrics**: Database performance and connections
- **Redis Metrics**: Cache performance and memory usage
- **S3 Metrics**: Storage usage and request patterns
- **Route53 Health Checks**: Domain availability monitoring

### Alerts
Automated alerts are configured for:

- High CPU/memory utilization
- Database connection issues
- Load balancer errors
- Health check failures
- Application errors
- AI service latency
- Blockchain transaction failures

### Log Groups
Centralized logging is configured for:

- Application logs
- AI service logs
- Gaming engine logs
- Blockchain service logs
- API gateway logs

## üîí Security Features

### Network Security
- VPC with private subnets for sensitive resources
- Security groups with least-privilege access
- WAF protection for web applications
- SSL/TLS encryption for all communications

### Data Security
- Encryption at rest for all storage
- Encryption in transit for all communications
- Secrets management for sensitive data
- IAM roles with minimal permissions

### Access Control
- IAM roles for ECS tasks
- Service accounts for Kubernetes
- Cross-account access controls
- Audit logging for all actions

## üö® Troubleshooting

### Common Issues

#### Terraform State Issues
```bash
# If state is corrupted or lost
terraform init -reconfigure
terraform import [resource] [id]
```

#### EKS Cluster Issues
```bash
# Update kubeconfig
aws eks update-kubeconfig --region us-east-1 --name gamedin-l3-cluster

# Check cluster status
kubectl get nodes
kubectl get pods --all-namespaces
```

#### RDS Connection Issues
```bash
# Check RDS status
aws rds describe-db-instances --db-instance-identifier gamedin-l3-rds

# Test connection
psql -h [endpoint] -U [username] -d [database]
```

#### Load Balancer Issues
```bash
# Check ALB status
aws elbv2 describe-load-balancers --names gamedin-l3-alb

# Check target health
aws elbv2 describe-target-health --target-group-arn [arn]
```

### Debug Commands

#### Terraform Debug
```bash
# Enable debug logging
export TF_LOG=DEBUG
export TF_LOG_PATH=terraform.log

# Check plan details
terraform plan -detailed-exitcode
```

#### AWS Debug
```bash
# Enable AWS CLI debug
export AWS_DEBUG=true

# Check AWS credentials
aws sts get-caller-identity
```

#### Kubernetes Debug
```bash
# Check cluster info
kubectl cluster-info

# Check node resources
kubectl describe nodes

# Check pod logs
kubectl logs [pod-name] -n [namespace]
```

## üìà Scaling and Performance

### Auto Scaling
The infrastructure includes auto scaling for:

- **EKS Node Groups**: Based on CPU and memory utilization
- **ECS Services**: Based on application load
- **RDS**: Read replicas for read-heavy workloads
- **Redis**: Multi-AZ deployment for high availability

### Performance Optimization
- **CDN**: CloudFront for static asset delivery
- **Caching**: Redis for session and data caching
- **Load Balancing**: ALB with health checks and stickiness
- **Database**: Connection pooling and query optimization

### Cost Optimization
- **Spot Instances**: For non-critical workloads
- **Reserved Instances**: For predictable workloads
- **S3 Lifecycle**: Automatic data archival
- **RDS Scheduling**: Stop/start for dev environments

## üîÑ Maintenance

### Regular Tasks
- **Security Updates**: Monthly security patches
- **Backup Verification**: Weekly backup testing
- **Performance Monitoring**: Daily performance reviews
- **Cost Analysis**: Monthly cost optimization

### Backup and Recovery
- **Automated Backups**: Daily RDS backups
- **Cross-Region Replication**: S3 bucket replication
- **Disaster Recovery**: Multi-AZ deployment
- **Point-in-Time Recovery**: RDS point-in-time restore

## üìö Additional Resources

### Documentation
- [AWS EKS Documentation](https://docs.aws.amazon.com/eks/)
- [Terraform Documentation](https://www.terraform.io/docs)
- [Kubernetes Documentation](https://kubernetes.io/docs/)

### Tools
- [AWS CLI](https://aws.amazon.com/cli/)
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [Terraform](https://www.terraform.io/downloads.html)

### Support
- [AWS Support](https://aws.amazon.com/support/)
- [Terraform Community](https://www.terraform.io/community)
- [Kubernetes Community](https://kubernetes.io/community/)

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

---

**Note**: This infrastructure is designed for production use. Always test in a development environment first and ensure you have proper backup and disaster recovery procedures in place. 